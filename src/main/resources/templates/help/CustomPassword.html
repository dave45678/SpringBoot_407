<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Password</title>
</head>
<body>
<div id="wrapper">
    <div class="container" id="page">
        <div class="container-inner">
            <div class="main">
                <div class="main-inner group">
                    <section class="content">
                        <div class="page-title pad group"><p id="breadcrumbs"><span><span><a
                                href="https://memorynotfound.com/">Home</a> » <span><a
                                href="https://memorynotfound.com/category/spring-framework/">Spring Framework</a> » <span><a
                                href="https://memorynotfound.com/category/spring-framework/spring-boot/">Spring Boot</a> » <strong
                                class="breadcrumb_last">Custom Password Constraint Validator Annotation Example</strong></span></span></span></span>
                        </p></div>
                        <div class="pad group">
                            <article
                                    class="post-7343 post type-post status-publish format-standard has-post-thumbnail hentry category-junit category-spring-boot category-spring-framework category-spring-security category-testing category-thymeleaf tag-integration-test tag-junit tag-mockmvc tag-security tag-spring-boot tag-spring-security">
                                <div class="post-inner group"><h1 class="post-title entry-title">Custom Password
                                    Constraint Validator Annotation Example</h1>
                                    <p class="post-byline">by <span class="vcard author"> <span class="fn"><a
                                            href="https://memorynotfound.com/author/memorynotfound/"
                                            title="Posts by MemoryNotFound"
                                            rel="author">MemoryNotFound</a></span> </span> &middot;
                                        <time class="published" datetime="November 9, 2017">November 9, 2017</time>
                                    </p>
                                    <div class="clear"></div>
                                    <div class="entry themeform share">
                                        <div class="entry-inner">
                                            <p>This tutorial demonstrates how to create a custom password validator
                                                annotation using custom password rules. You&#8217;ll be able to annotate
                                                your password field with a <code>@ValidPassword</code>. This&#8217;ll
                                                trigger the custom <code>PasswordConstraintValidator</code> which&#8217;ll
                                                enforce a server-side password policy.</p>
                                            <div class="ads-content-between">
                                                <script async
                                                        src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                                                <ins class="adsbygoogle"
                                                     style="display:block; text-align:center;"
                                                     data-ad-layout="in-article"
                                                     data-ad-format="fluid"
                                                     data-ad-client="ca-pub-5441368398321360"
                                                     data-ad-slot="5698013731"></ins>
                                                <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
                                            </div>
                                            <h3>Password Policy</h3>
                                            <p>We can create our own custom password validation rules. We created the
                                                following password policy:</p>
                                            <ul>
                                                <li>The password length must be between 8 and 30 characters.</li>
                                                <li>The password must contain at least 1 upper-case character.</li>
                                                <li>The password must contain at least 1 lower-case character.</li>
                                                <li>The password must contain at least 1 digit character.</li>
                                                <li>The password must contain at least 1 symbol (special character).
                                                </li>
                                                <li>The password cannot contain whitespaces.</li>
                                                <li>The password cannot match from dictionary.</li>
                                            </ul>
                                            <h2>Project Structure</h2>
                                            <p>Let&#8217;s start by looking at the project structure.</p>
                                            <picture width="800" height="567"
                                                     class="aligncenter size-full wp-image-7350 sp-no-webp">
                                                <source data-srcset="https://memorynotfound.com/wp-content/uploads/custom-password-constraint-validator-annotation-example-project-structure.webp"
                                                        type="image/webp">
                                                <source data-srcset="https://memorynotfound.com/wp-content/uploads/custom-password-constraint-validator-annotation-example-project-structure.png">
                                                <img data-src="https://memorynotfound.com/wp-content/uploads/custom-password-constraint-validator-annotation-example-project-structure.png"
                                                     width="800" height="567"
                                                     class="aligncenter size-full wp-image-7350 sp-no-webp"
                                                     alt="custom-password-constraint-validator-annotation-example-project-structure"
                                                     srcset="https://memorynotfound.com/wp-content/uploads/custom-password-constraint-validator-annotation-example-project-structure.png">
                                            </picture>
                                            <h2>Maven Dependencies</h2>
                                            <p>We use Apache Maven to manage our project dependencies. Make sure the
                                                following dependencies reside on the class-path. We use <code>org.passay:passay</code>
                                                which provides a comprehensive and extensible feature set of password
                                                policy enforcement.</p>
                                            <pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0
                             http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;

    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;com.memorynotfound.spring.security&lt;/groupId&gt;
    &lt;artifactId&gt;password-strength&lt;/artifactId&gt;
    &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
    &lt;url&gt;http://memorynotfound.com&lt;/url&gt;
    &lt;name&gt;Spring Security - ${project.artifactId}&lt;/name&gt;

    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;1.5.8.RELEASE&lt;/version&gt;
    &lt;/parent&gt;

    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;commons-beanutils&lt;/groupId&gt;
            &lt;artifactId&gt;commons-beanutils&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.passay&lt;/groupId&gt;
            &lt;artifactId&gt;passay&lt;/artifactId&gt;
            &lt;version&gt;1.3.0&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- bootstrap and jquery --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.webjars&lt;/groupId&gt;
            &lt;artifactId&gt;bootstrap&lt;/artifactId&gt;
            &lt;version&gt;3.3.7&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.webjars&lt;/groupId&gt;
            &lt;artifactId&gt;jquery&lt;/artifactId&gt;
            &lt;version&gt;3.2.1&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- testing --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;</code></pre>
                                            <h2>Custom @ValidPassword Annotation</h2>
                                            <p>Let&#8217;s start by creating the <code>@ValidPassword</code> annotation.
                                                This annotation is a field-level annotation which is validated by the
                                                <code>PasswordConstraintValidator</code> that we&#8217;ll create in the
                                                following section.</p>
                                            <pre><code class="java">package com.memorynotfound.spring.security.constraint;

import javax.validation.Payload;
import javax.validation.Constraint;
import java.lang.annotation.Documented;
import java.lang.annotation.Retention;
import java.lang.annotation.Target;
import static java.lang.annotation.ElementType.ANNOTATION_TYPE;
import static java.lang.annotation.ElementType.TYPE;
import static java.lang.annotation.ElementType.FIELD;
import static java.lang.annotation.RetentionPolicy.RUNTIME;

@Documented
@Constraint(validatedBy = PasswordConstraintValidator.class)
@Target({ TYPE, FIELD, ANNOTATION_TYPE })
@Retention(RUNTIME)
public @interface ValidPassword {

    String message() default &quot;Invalid Password&quot;;
    Class&lt;?&gt;[] groups() default {};
    Class&lt;? extends Payload&gt;[] payload() default {};

}</code></pre>
                                            <h2>Custom Password Constraint Validator</h2>
                                            <p>Here, we create the actual password validator. We use <code>org.passay:passay</code>
                                                to enforce our custom password policy. We start by initializing a <code>DictionaryRule</code>
                                                which reads and parses a list of insecure password which the user cannot
                                                use. Finally, we create a <code>PasswordValidator</code> and pass the
                                                different password rules as arguments to the constructor. We enforce our
                                                password policy by creating different rules.</p>
                                            <ul>
                                                <li><code>LengthRule(8, 30)</code> &#8211; enforces the password length
                                                    to be between 8 and 30 characters.
                                                </li>
                                                <li><code>CharacterRule(EnglishCharacterData.UpperCase, 1)</code>
                                                    &#8211; enforces the password to have at least 1 upper-case
                                                    character.
                                                </li>
                                                <li><code>CharacterRule(EnglishCharacterData.LowerCase, 1)</code>
                                                    &#8211; enforces the password to have at least 1 lower-case
                                                    character.
                                                </li>
                                                <li><code>CharacterRule(EnglishCharacterData.Digit, 1)</code> &#8211;
                                                    enforces the password to have at least 1 digit character.
                                                </li>
                                                <li><code>CharacterRule(EnglishCharacterData.Special, 1)</code> &#8211;
                                                    enforces the password to have at least 1 symbol (special character).
                                                </li>
                                                <li><code>WhitespaceRule</code> &#8211; enforces the password does not
                                                    contain a whitespace.
                                                </li>
                                            </ul>
                                            <pre><code class="java">package com.memorynotfound.spring.security.constraint;

import org.passay.*;
import org.passay.dictionary.WordListDictionary;
import org.passay.dictionary.WordLists;
import org.passay.dictionary.sort.ArraysSort;

import javax.validation.ConstraintValidator;
import javax.validation.ConstraintValidatorContext;
import java.io.FileReader;
import java.io.IOException;
import java.util.Arrays;
import java.util.List;
import java.util.stream.Collectors;

public class PasswordConstraintValidator implements ConstraintValidator&lt;ValidPassword, String&gt; {

    private DictionaryRule dictionaryRule;

    @Override
    public void initialize(ValidPassword constraintAnnotation) {
        try {
            String invalidPasswordList = this.getClass().getResource(&quot;/invalid-password-list.txt&quot;).getFile();
            dictionaryRule = new DictionaryRule(
                    new WordListDictionary(WordLists.createFromReader(
                            // Reader around the word list file
                            new FileReader[] {
                                    new FileReader(invalidPasswordList)
                            },
                            // True for case sensitivity, false otherwise
                            false,
                            // Dictionaries must be sorted
                            new ArraysSort()
                    )));
        } catch (IOException e) {
            throw new RuntimeException(&quot;could not load word list&quot;, e);
        }
    }

    @Override
    public boolean isValid(String password, ConstraintValidatorContext context) {
        PasswordValidator validator = new PasswordValidator(Arrays.asList(

                // at least 8 characters
                new LengthRule(8, 30),

                // at least one upper-case character
                new CharacterRule(EnglishCharacterData.UpperCase, 1),

                // at least one lower-case character
                new CharacterRule(EnglishCharacterData.LowerCase, 1),

                // at least one digit character
                new CharacterRule(EnglishCharacterData.Digit, 1),

                // at least one symbol (special character)
                new CharacterRule(EnglishCharacterData.Special, 1),

                // no whitespace
                new WhitespaceRule(),

                // no common passwords
                dictionaryRule
        ));

        RuleResult result = validator.validate(new PasswordData(password));

        if (result.isValid()) {
            return true;
        }

        List&lt;String&gt; messages = validator.getMessages(result);
        String messageTemplate = messages.stream().collect(Collectors.joining(&quot;,&quot;));
        context.buildConstraintViolationWithTemplate(messageTemplate)
                .addConstraintViolation()
                .disableDefaultConstraintViolation();
        return false;
    }
}</code></pre>
                                            <p>The <code>invalid-password-list.txt</code> is loaded from the <code>src/main/resources</code>
                                                folder. You can add any password to this list which the user isn&#8217;t
                                                able to use.</p>
                                            <pre><code class="ini">azerty12!
12345678!
password123</code></pre>
                                            <h2>Using the Password Validator Annotation</h2>
                                            <p>We use the <code>@ValidPassword</code> annotation on <code>FIELD</code>
                                                level.</p>
                                            <pre><code class="java">package com.memorynotfound.spring.security.web.dto;

import com.memorynotfound.spring.security.constraint.ValidPassword;
import org.hibernate.validator.constraints.Email;
import org.hibernate.validator.constraints.NotEmpty;
import javax.validation.constraints.AssertTrue;

public class UserRegistrationDto {

    @NotEmpty
    private String firstName;

    @NotEmpty
    private String lastName;

    @NotEmpty
    @ValidPassword
    private String password;

    @NotEmpty
    @ValidPassword
    private String confirmPassword;

    @Email
    @NotEmpty
    private String email;

    @Email
    @NotEmpty
    private String confirmEmail;

    @AssertTrue
    private Boolean terms;

    public String getFirstName() {
        return firstName;
    }

    public void setFirstName(String firstName) {
        this.firstName = firstName;
    }

    public String getLastName() {
        return lastName;
    }

    public void setLastName(String lastName) {
        this.lastName = lastName;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public String getConfirmPassword() {
        return confirmPassword;
    }

    public void setConfirmPassword(String confirmPassword) {
        this.confirmPassword = confirmPassword;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    public String getConfirmEmail() {
        return confirmEmail;
    }

    public void setConfirmEmail(String confirmEmail) {
        this.confirmEmail = confirmEmail;
    }

    public Boolean getTerms() {
        return terms;
    }

    public void setTerms(Boolean terms) {
        this.terms = terms;
    }

}</code></pre>
                                            <h2>User Registration Controller</h2>
                                            <p>To demonstrate a form submission, we created the <code>UserRegistrationController</code>.
                                                The <code>UserRegistrationDto</code> is validated upon form post using
                                                the <code>@Vali</code> annotation.</p>
                                            <pre><code class="java">package com.memorynotfound.spring.security.web;

import com.memorynotfound.spring.security.web.dto.UserRegistrationDto;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;

import javax.validation.Valid;

@Controller
@RequestMapping(&quot;/registration&quot;)
public class UserRegistrationController {

    @ModelAttribute(&quot;user&quot;)
    public UserRegistrationDto userRegistrationDto() {
        return new UserRegistrationDto();
    }

    @GetMapping
    public String showRegistrationForm(Model model) {
        return &quot;registration&quot;;
    }

    @PostMapping
    public String registerUserAccount(@ModelAttribute(&quot;user&quot;) @Valid UserRegistrationDto userDto,
                                      BindingResult result){

        if (result.hasErrors()){
            return &quot;registration&quot;;
        }

        return &quot;redirect:/registration?success&quot;;
    }

}</code></pre>
                                            <h2>Spring Boot</h2>
                                            <p>We use Spring Boot to start our application.</p>
                                            <pre><code class="java">package com.memorynotfound.spring.security;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class Run {

    public static void main(String[] args) {
        SpringApplication.run(Run.class, args);
    }

}</code></pre>
                                            <h2>User Registration Thymeleaf Template</h2>
                                            <p>The <code>registration.html</code> uses <code>bootstrap</code> and <code>jquery</code>
                                                and is located in the <code>src/main/resources/templates/</code> folder.
                                            </p>
                                            <pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;/&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;/&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;/&gt;

    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; th:href=&quot;@{/webjars/bootstrap/3.3.7/css/bootstrap.min.css}&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; th:href=&quot;@{/css/main.css}&quot;/&gt;

    &lt;title&gt;Registration&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&quot;container&quot;&gt;
    &lt;div class=&quot;row&quot;&gt;
        &lt;div class=&quot;col-md-6 col-md-offset-3&quot;&gt;
            &lt;div class=&quot;panel panel-default&quot;&gt;
                &lt;div class=&quot;panel-body&quot;&gt;
                    &lt;div class=&quot;text-center&quot;&gt;
                        &lt;h3&gt;&lt;i class=&quot;glyphicon glyphicon-user&quot; style=&quot;font-size:2em;&quot;&gt;&lt;/i&gt;&lt;/h3&gt;
                        &lt;h2 class=&quot;text-center&quot;&gt;Register&lt;/h2&gt;
                        &lt;div class=&quot;panel-body&quot;&gt;

                            &lt;div th:if=&quot;${param.success}&quot;&gt;
                                &lt;div class=&quot;alert alert-info&quot;&gt;
                                    You've successfully registered to our awesome app!
                                &lt;/div&gt;
                            &lt;/div&gt;

                            &lt;form th:action=&quot;@{/registration}&quot; th:object=&quot;${user}&quot; method=&quot;post&quot;&gt;

                                &lt;p class=&quot;error-message&quot;
                                   th:if=&quot;${#fields.hasGlobalErrors()}&quot;
                                   th:each=&quot;error : ${#fields.errors('global')}&quot;
                                   th:text=&quot;${error}&quot;&gt;Validation error&lt;/p&gt;


                                &lt;div class=&quot;form-group&quot;
                                     th:classappend=&quot;${#fields.hasErrors('firstName')}? 'has-error':''&quot;&gt;
                                    &lt;div class=&quot;input-group&quot;&gt;
                                        &lt;span class=&quot;input-group-addon&quot;&gt;
                                            &lt;i class=&quot;glyphicon glyphicon-user color-blue&quot;&gt;&lt;/i&gt;
                                        &lt;/span&gt;
                                        &lt;input id=&quot;firstName&quot;
                                               class=&quot;form-control&quot;
                                               placeholder=&quot;First name&quot;
                                               th:field=&quot;*{firstName}&quot;/&gt;
                                    &lt;/div&gt;
                                    &lt;p class=&quot;error-message&quot;
                                       th:each=&quot;error: ${#fields.errors('firstName')}&quot;
                                       th:text=&quot;${error}&quot;&gt;Validation error&lt;/p&gt;
                                &lt;/div&gt;
                                &lt;div class=&quot;form-group&quot;
                                     th:classappend=&quot;${#fields.hasErrors('lastName')}? 'has-error':''&quot;&gt;
                                    &lt;div class=&quot;input-group&quot;&gt;
                                        &lt;span class=&quot;input-group-addon&quot;&gt;
                                            &lt;i class=&quot;glyphicon glyphicon-user color-blue&quot;&gt;&lt;/i&gt;
                                        &lt;/span&gt;
                                        &lt;input id=&quot;lastName&quot;
                                               class=&quot;form-control&quot;
                                               placeholder=&quot;Last name&quot;
                                               th:field=&quot;*{lastName}&quot;/&gt;
                                    &lt;/div&gt;
                                    &lt;p class=&quot;error-message&quot;
                                       th:each=&quot;error: ${#fields.errors('lastName')}&quot;
                                       th:text=&quot;${error}&quot;&gt;Validation error&lt;/p&gt;
                                &lt;/div&gt;
                                &lt;div class=&quot;form-group&quot;
                                     th:classappend=&quot;${#fields.hasErrors('email')}? 'has-error':''&quot;&gt;
                                    &lt;div class=&quot;input-group&quot;&gt;
                                        &lt;span class=&quot;input-group-addon&quot;&gt;@&lt;/span&gt;
                                        &lt;input id=&quot;email&quot;
                                               class=&quot;form-control&quot;
                                               placeholder=&quot;E-mail&quot;
                                               th:field=&quot;*{email}&quot;/&gt;
                                    &lt;/div&gt;
                                    &lt;p class=&quot;error-message&quot;
                                       th:each=&quot;error: ${#fields.errors('email')}&quot;
                                       th:text=&quot;${error}&quot;&gt;Validation error&lt;/p&gt;
                                &lt;/div&gt;
                                &lt;div class=&quot;form-group&quot;
                                     th:classappend=&quot;${#fields.hasErrors('confirmEmail')}? 'has-error':''&quot;&gt;
                                    &lt;div class=&quot;input-group&quot;&gt;
                                        &lt;span class=&quot;input-group-addon&quot;&gt;@&lt;/span&gt;
                                        &lt;input id=&quot;confirmEmail&quot;
                                               class=&quot;form-control&quot;
                                               placeholder=&quot;Confirm e-mail&quot;
                                               th:field=&quot;*{confirmEmail}&quot;/&gt;
                                    &lt;/div&gt;
                                    &lt;p class=&quot;error-message&quot;
                                       th:each=&quot;error: ${#fields.errors('confirmEmail')}&quot;
                                       th:text=&quot;${error}&quot;&gt;Validation error&lt;/p&gt;
                                &lt;/div&gt;
                                &lt;div class=&quot;form-group&quot;
                                     th:classappend=&quot;${#fields.hasErrors('password')}? 'has-error':''&quot;&gt;
                                    &lt;div class=&quot;input-group&quot;&gt;
                                        &lt;span class=&quot;input-group-addon&quot;&gt;
                                            &lt;i class=&quot;glyphicon glyphicon-lock&quot;&gt;&lt;/i&gt;
                                        &lt;/span&gt;
                                        &lt;input id=&quot;password&quot;
                                               class=&quot;form-control&quot;
                                               placeholder=&quot;password&quot;
                                               type=&quot;password&quot;
                                               th:field=&quot;*{password}&quot;/&gt;
                                    &lt;/div&gt;
                                    &lt;ul class=&quot;text-left&quot;
                                        th:each=&quot;error: ${#fields.errors('password')}&quot;&gt;
                                        &lt;li th:each=&quot;message : ${error.split(',')}&quot;&gt;
                                            &lt;p class=&quot;error-message&quot;
                                               th:text=&quot;${message}&quot;&gt;&lt;/p&gt;
                                        &lt;/li&gt;
                                    &lt;/ul&gt;
                                &lt;/div&gt;
                                &lt;div class=&quot;form-group&quot;
                                     th:classappend=&quot;${#fields.hasErrors('confirmPassword')}? 'has-error':''&quot;&gt;
                                    &lt;div class=&quot;input-group&quot;&gt;
                                        &lt;span class=&quot;input-group-addon&quot;&gt;
                                            &lt;i class=&quot;glyphicon glyphicon-lock&quot;&gt;&lt;/i&gt;
                                        &lt;/span&gt;
                                        &lt;input id=&quot;confirmPassword&quot;
                                               class=&quot;form-control&quot;
                                               type=&quot;password&quot;
                                               placeholder=&quot;Confirm password&quot;
                                               th:field=&quot;*{confirmPassword}&quot;/&gt;
                                    &lt;/div&gt;
                                    &lt;ul class=&quot;text-left&quot;
                                            th:each=&quot;error: ${#fields.errors('confirmPassword')}&quot;&gt;
                                        &lt;li th:each=&quot;message : ${error.split(',')}&quot;&gt;
                                            &lt;p class=&quot;error-message&quot;
                                               th:text=&quot;${message}&quot;&gt;&lt;/p&gt;
                                        &lt;/li&gt;
                                    &lt;/ul&gt;
                                &lt;/div&gt;
                                &lt;div class=&quot;form-group&quot;
                                     th:classappend=&quot;${#fields.hasErrors('terms')}? 'has-error':''&quot;&gt;
                                    &lt;input id=&quot;terms&quot;
                                           type=&quot;checkbox&quot;
                                           th:field=&quot;*{terms}&quot;/&gt; &nbsp;
                                    &lt;label class=&quot;control-label&quot; for=&quot;terms&quot;&gt;
                                        I agree with the &lt;a href=&quot;#&quot;&gt;terms and conditions&lt;/a&gt; for Registration.
                                    &lt;/label&gt;
                                    &lt;p class=&quot;error-message&quot;
                                       th:each=&quot;error : ${#fields.errors('terms')}&quot;
                                       th:text=&quot;${error}&quot;&gt;Validation error&lt;/p&gt;
                                &lt;/div&gt;
                                &lt;div class=&quot;form-group&quot;&gt;
                                    &lt;button type=&quot;submit&quot; class=&quot;btn btn-success btn-block&quot;&gt;Register&lt;/button&gt;
                                &lt;/div&gt;
                            &lt;/form&gt;

                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class=&quot;row&quot;&gt;
                &lt;div class=&quot;col-md-12&quot;&gt;
                    Already registered? &lt;a href=&quot;/&quot; th:href=&quot;@{/login}&quot;&gt;Login&lt;/a&gt;
                &lt;/div&gt;
                &lt;div class=&quot;col-md-12&quot;&gt;
                    Forgot password? &lt;a href=&quot;/&quot; th:href=&quot;@{/forgot-password}&quot;&gt;Reset password&lt;/a&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;script type=&quot;text/javascript&quot; th:src=&quot;@{/webjars/jquery/3.2.1/jquery.min.js/}&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; th:src=&quot;@{/webjars/bootstrap/3.3.7/js/bootstrap.min.js}&quot;&gt;&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>
                                            <h2>Demo</h2>
                                            <p>Access the <code>http://localhost:8080/registration</code> url and try it
                                                out.</p>
                                            <picture width="800" height="945"
                                                     class="aligncenter size-full wp-image-7345 sp-no-webp">
                                                <source data-srcset="https://memorynotfound.com/wp-content/uploads/custom-password-constraint-validator-annotation-example.webp"
                                                        type="image/webp">
                                                <source data-srcset="https://memorynotfound.com/wp-content/uploads/custom-password-constraint-validator-annotation-example.png">
                                                <img data-src="https://memorynotfound.com/wp-content/uploads/custom-password-constraint-validator-annotation-example.png"
                                                     width="800" height="945"
                                                     class="aligncenter size-full wp-image-7345 sp-no-webp"
                                                     alt="custom-password-constraint-validator-annotation-example"
                                                     srcset="https://memorynotfound.com/wp-content/uploads/custom-password-constraint-validator-annotation-example.png">
                                            </picture>
                                            <h2>Password Validator Integration Testing</h2>
                                            <p>To validate if our controller is functioning properly, we created some
                                                integration tests using <code>spring-test</code> and
                                                <code>MockMvc</code>.</p>
                                            <pre><code class="java">package com.memorynotfound.spring.security.test;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
import org.springframework.test.web.servlet.MockMvc;

import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;

@SpringBootTest
@AutoConfigureMockMvc
@RunWith(SpringJUnit4ClassRunner.class)
public class UserRegistrationIT {

    @Autowired
    private MockMvc mockMvc;

    @Test
    public void submitRegistrationPasswordNotValid() throws Exception {
        this.mockMvc
                .perform(
                        post(&quot;/registration&quot;)
                                .param(&quot;firstName&quot;, &quot;Memory&quot;)
                                .param(&quot;lastName&quot;, &quot;Not Found&quot;)
                                .param(&quot;email&quot;, &quot;<a href="/cdn-cgi/l/email-protection"
                                                                   class="__cf_email__"
                                                                   data-cfemail="3e505b497e535b53514c4750514a58514b505a105d5153">[email&#160;protected]</a>&quot;)
                                .param(&quot;confirmEmail&quot;, &quot;<a href="/cdn-cgi/l/email-protection"
                                                                          class="__cf_email__"
                                                                          data-cfemail="315f5446715c545c5e43485f5e45575e445f">[email&#160;protected]</a>d.com&quot;)
                                .param(&quot;password&quot;, &quot;password&quot;)
                                .param(&quot;confirmPassword&quot;, &quot;password&quot;)
                                .param(&quot;terms&quot;, &quot;on&quot;)
                )
                .andExpect(model().hasErrors())
                .andExpect(model().attributeHasFieldErrors(&quot;user&quot;, &quot;password&quot;, &quot;confirmPassword&quot;))
                .andExpect(status().isOk());
    }

    @Test
    public void submitRegistrationPasswordNotMatching() throws Exception {
        this.mockMvc
                .perform(
                        post(&quot;/registration&quot;)
                                .param(&quot;firstName&quot;, &quot;Memory&quot;)
                                .param(&quot;lastName&quot;, &quot;Not Found&quot;)
                                .param(&quot;email&quot;, &quot;<a href="/cdn-cgi/l/email-protection"
                                                                   class="__cf_email__"
                                                                   data-cfemail="0a646f7d4a676f6765787364657e6c657f646e24696567">[email&#160;protected]</a>&quot;)
                                .param(&quot;confirmEmail&quot;, &quot;<a href="/cdn-cgi/l/email-protection"
                                                                          class="__cf_email__"
                                                                          data-cfemail="117f7466517c747c7e63687f7e65777e647f753f727e7c">[email&#160;protected]</a>&quot;)
                                .param(&quot;password&quot;, &quot;xjD1!3djk4&quot;)
                                .param(&quot;confirmPassword&quot;, &quot;xjD1!3djk3&quot;)
                                .param(&quot;terms&quot;, &quot;on&quot;)
                )
                .andExpect(model().hasErrors())
                .andExpect(model().attributeHasErrors(&quot;user&quot;))
                .andExpect(status().isOk());
    }


    @Test
    public void submitRegistrationSuccess() throws Exception {
        this.mockMvc
                .perform(
                        post(&quot;/registration&quot;)
                                .param(&quot;firstName&quot;, &quot;Memory&quot;)
                                .param(&quot;lastName&quot;, &quot;Not Found&quot;)
                                .param(&quot;email&quot;, &quot;<a href="/cdn-cgi/l/email-protection"
                                                                   class="__cf_email__"
                                                                   data-cfemail="b2dcd7c5f2dfd7dfddc0cbdcddc6d4ddc7dcd69cd1dddf">[email&#160;protected]</a>&quot;)
                                .param(&quot;confirmEmail&quot;, &quot;<a href="/cdn-cgi/l/email-protection"
                                                                          class="__cf_email__"
                                                                          data-cfemail="a1cfc4d6e1ccc4ccced3d8cfced5c7ced4cfc58fc2cecc">[email&#160;protected]</a>&quot;)
                                .param(&quot;password&quot;, &quot;xjD1!3djk4&quot;)
                                .param(&quot;confirmPassword&quot;, &quot;xjD1!3djk4&quot;)
                                .param(&quot;terms&quot;, &quot;on&quot;)
                )
                .andExpect(model().hasNoErrors())
                .andExpect(redirectedUrl(&quot;/registration?success&quot;))
                .andExpect(status().is3xxRedirection());
    }

}</code></pre>
                                            <h2>Password Constraint Validator Unit Testing</h2>
                                            <p>We also wrote a <code>JUnit</code> Unit Test to validate if our <code>PasswordConstraintValidator</code>
                                                and <code>ValidPassword</code> annotation are working properly.</p>
                                            <pre><code class="java">package com.memorynotfound.spring.security.test;

import com.memorynotfound.spring.security.web.dto.UserRegistrationDto;
import org.junit.Assert;
import org.junit.BeforeClass;
import org.junit.Test;
import javax.validation.ConstraintViolation;
import javax.validation.Validation;
import javax.validation.Validator;
import javax.validation.ValidatorFactory;
import java.util.Set;

public class PasswordConstraintValidatorTest {

    private static Validator validator;

    @BeforeClass
    public static void setUp() {
        ValidatorFactory factory = Validation.buildDefaultValidatorFactory();
        validator = factory.getValidator();
    }

    @Test
    public void testInvalidPassword() {
        UserRegistrationDto userRegistration = new UserRegistrationDto();
        userRegistration.setFirstName(&quot;memory&quot;);
        userRegistration.setLastName(&quot;not found&quot;);
        userRegistration.setEmail(&quot;<a href="/cdn-cgi/l/email-protection" class="__cf_email__"
                                           data-cfemail="335a5d555c735e565e5c414a5d5c47555c465d571d505c5e">[email&#160;protected]</a>&quot;);
        userRegistration.setConfirmEmail(&quot;<a href="/cdn-cgi/l/email-protection" class="__cf_email__"
                                                  data-cfemail="c3aaada5ac83aea6aeacb1baadacb7a5acb6ada7eda0acae">[email&#160;protected]</a>&quot;);
        userRegistration.setPassword(&quot;password&quot;);
        userRegistration.setConfirmPassword(&quot;password&quot;);
        userRegistration.setTerms(true);

        Set&lt;ConstraintViolation&lt;UserRegistrationDto&gt;&gt; constraintViolations = validator.validate(userRegistration);

        Assert.assertEquals(constraintViolations.size(), 2);
    }

    @Test
    public void testValidPasswords() {
        UserRegistrationDto userRegistration = new UserRegistrationDto();
        userRegistration.setFirstName(&quot;memory&quot;);
        userRegistration.setLastName(&quot;not found&quot;);
        userRegistration.setEmail(&quot;<a href="/cdn-cgi/l/email-protection" class="__cf_email__"
                                           data-cfemail="254c4b434a654840484a575c4b4a51434a504b410b464a48">[email&#160;protected]</a>&quot;);
        userRegistration.setConfirmEmail(&quot;<a href="/cdn-cgi/l/email-protection" class="__cf_email__"
                                                  data-cfemail="e980878f86a9848c84869b9087869d8f869c878dc78a8684">[email&#160;protected]</a>&quot;);
        userRegistration.setPassword(&quot;xJ3!dij50&quot;);
        userRegistration.setConfirmPassword(&quot;xJ3!dij50&quot;);
        userRegistration.setTerms(true);

        Set&lt;ConstraintViolation&lt;UserRegistrationDto&gt;&gt; constraintViolations = validator.validate(userRegistration);

        Assert.assertEquals(constraintViolations.size(), 0);
    }
}
</code></pre>
                                            <h2>References</h2>
                                            <ul>
                                                <li><a href="http://www.passay.org/" rel="nofollow">Passay Official
                                                    Website</a></li>
                                                <li><a href="http://www.passay.org/javadocs/" rel="nofollow">Passay API
                                                    JavaDoc</a></li>
                                                <li>
                                                    <a href="http://www.passay.org/javadocs/org/passay/PasswordValidator.html"
                                                       rel="nofollow">PasswordValidator JavaDoc</a></li>
                                            </ul>

</div>
                                    </div>
                                </div>
                            </article>
                        </div>
                    </section>

                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>